# NeoEnigma：中文
## 简介
**NeoEnigma**（*新谜加密*）是一个由法国高中生开发的个人实验性加密程序。其核心使用改良的**恩尼格玛机**置换结构，并由密钥配随机盐生成一系列庞大数值范围的机械参数。同时，加密过程使用诸多现代加密方式对数据进行处理，包含随机盐、MAC认证等。

此程序使用python3.13编写，使用了一个第三方库，为argon2。请在终端中使用pip安装第三方库以允许本程序：`pip install argon2-cffi`

同时，程序中使用了Noto Mono作为GUI字体，为有最佳体验，推荐安装该字体。

## 运作逻辑
程序有多个类进行处理，后端处理逻辑共有**主加密处理、恩尼格玛机置换与恩尼格玛机参数派生**三大类，各个负责不同的作用，以下便是其运作逻辑。

### 主加密处理
**主加密**负责整个文本处理，以下针对加密进行介绍：

1. 压缩处理明文，并转换压缩结果的bytes值至十六进制字符串。
2. 交叉混淆压缩明文的十六进制结果。
   1. 示例：`abcdef` -> `bdface`
3. 生成16字节的随机盐。
4. 投入随机盐与密钥至argon2，并获取转为十六进制的输出结果。
5. 投入argon2结果与混淆过的明文至恩尼各玛类，并获取加密结果。
6. 使用argon2结果作为key，十六进制的随机盐+密文作为msg，sha3_512作为算法生成hmac。
7. 使用shake256截取16字节长度的mac。
8. 输出随机盐+密文+mac。

#### 第二部分解释
这一混淆本质上是更改恩尼各玛加密核心对原文本进行置换的顺序。目的是保证文本必须在完整解密的情况下才可恢复原始数据，避免攻击者对密文进行裁剪等操作。可以理解为恩尼各玛对每个字符的加密流程变为以下这样：

| 以`abcdef`为例 | a | b | c | d | e | f |
|---------------|---|---|---|---|---|---|
| 第一部分 |   | x |   | x |   | x |
| 第二部分 | x |   | x |   | x |   |

### 恩尼各玛类
**恩尼各玛类**的运作方式与二战历史的恩尼各玛机类似，尤其在置换逻辑上。区别在于其参数是通过密钥派生生成的，同时其负责置换的字母表是十六进制字符。在程序中，总共会生成以下参数：**轮子、每个论组的初始偏移值、进位幅度、中间字符转换**。具体生成过程见下文。

最大的区别在于进位幅度，原版恩尼各玛机每置换一个文本便会进位一格，而这里则可以进位多格且幅度派生於argon2。

同时，恩尼各玛的字符表并非固定。在每次加密开始时，便会将十六进制字符表通过argon2参数的sha3-256结果作为种子进行打乱，最终以此字符表为基础构建后续。此字符表的共有16!种排序空间。

### 恩尼各玛参数类
**恩尼各玛参数类**的作用是将argon2参数的sha3-512十六进制值（128个十六进制字符，下文称其为「主参数」）进行参数化。程序会通过这128个字符派生上述恩尼各玛机将会使用的参数。

**轮子**参数基于十六进制字符表（被一开始的恩尼各玛类打乱）的乱序，其种子基于主参数的一部分。程序会截取主参数108个字符，并将其切分为9等分，总共会得到9个12字符长度的十六进制值。这些值将被用于种子，每个都将生成一个十六进制字符表的打乱。因此，所有轮子加起来的参数范围大约为(16!)^9，在密钥熵允许的情况下。

**轮子初始偏移**参数的生成是基于主参数，通过shake256进行派生，并将其切分给9个轮子。因为初始值会被取余，整体的参数范围大约为16^9。

**中间字符转换**用于字符过了一遍轮子后将其转换再往回过一遍轮子，保证加密与解密使用相同的程序。其会使用轮子用剩的20个字符中的12个字符，以同样的方式打乱十六进制表，最后将打乱结果以每两个字符切分。 其参数范围为16!/2，因为结果切分为`ab`和`ba`是一样的转换。

**进位幅度**或者**转动幅度**是每加密一次字符转动轮子的次数。在原始恩尼各玛机中，这个数值被固定为一次，而在这个程序中，它会使用上述参数用剩下的最后8个主参数字符生成一个数值。其范围大约落在1~FFFFFFFF+1。
